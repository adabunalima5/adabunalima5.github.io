{% if page.categories %}
  <div class="related-posts-grid">
    {% for category in page.categories %}
      {% assign related_posts = site.categories[category] %}
      {% for post in related_posts limit: 9 %}
        {% if post.url != page.url %}
          <div class="related-post">
            <a href="{{ post.url }}">
              {% if post.image %}
                <img src="{{ post.image }}" alt="{{ post.title }}" class="related-post-image">
              {% endif %}
              <span>{{ post.title }}</span>
            </a>
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>
{% else %}
  <p>No related posts found.</p>
{% endif %}
